using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class InvulnerabilityPower : ICardPower
{
    private readonly GameObject _prefab;
    private readonly bool _invulnerability; //no se como está hecho pero podemos poner un porcentaje como el de reduce enemie stats o un booleano para que reciba o no daño.
    private readonly float _duration;
    private readonly float _range;
    private readonly Color _color;
    private readonly string[] _targetLayerMasks;
    private readonly TargetDetector _targetDetector;

    public InvulnerabilityPower(GameObject prefab, bool invulnerability, float duration, float range, Color color, string[] targetLayerMasks)
    {
        _prefab = prefab;
        _invulnerability = invulnerability;
        _duration = duration;
        _range = range;
        _color = color;
        _targetLayerMasks = targetLayerMasks;
        _targetDetector = new TargetDetector(_range, _targetLayerMasks);
    }

    public bool Activate(GameObject gameobject, Transform transform)
    {
        if (_range < 100f)
        {
            GameObject spellSphere = GameObject.Instantiate(_prefab, transform.position, Quaternion.identity);
            spellSphere.GetComponent<SpellSphere>().SetRangeAndColor(_range, _color);
            spellSphere.SendMessage("TheStart");
        }

        _targetDetector.SetTransform(transform.transform);

        IReadOnlyList<Transform> objetives = _targetDetector.GetAllTargetsInRange();
        foreach (Transform t in objetives)
        {
            t.gameObject.GetComponent<IHeal>().BecomeInvulnerable(_duration);
        }
        return true;
    }
}
